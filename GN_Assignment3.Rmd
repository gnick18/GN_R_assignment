---
title: "GN Assignment3"
author: "Grant Nickles"
date: "10/12/2019"
output: html_document
---

First I will call the packages needed to graph and manipulate the data.
```{r}
library(ggplot2)
library(tidyverse)
library(dplyr)
library(forcats)
```

#**Data Inspection**

##**Inspection of fang_et_al_genotypes.txt**

Reading in the data
```{r}
fang = read.delim("fang_et_al_genotypes.txt", header = TRUE, sep = "\t")
```
Checking the rows and columns of the file: The file appears to have 2782 rows and 986 columns. Thus there are 2782 unique observations. This is a very large file and thus it will be unreasonable to by hand look at all the columns or data points. The byte size is 12,163,888.
```{r}
dim(fang)
object.size(fang)
```

Checking on the first six rows of the data I'm able to pull a couple pieces of information. The Samples are labled in the "Sample_ID" colume. Missing data appears to be indicated with "?" and the diploid copies of each SNP location is separted with "/". The 2nd and 3rd column both have other info on the samples but are not SNP data.
```{r}
head(fang)
```





##**Inspection of snp_position.txt**

Reading in the data
```{r}
snp = read.delim("snp_position.txt", header = TRUE, sep = "\t")
```

Checking the rows and columns on the SNP file there appears to be 15 columns and 983 rows. Supbracting the rows in the fang file that are not relavent to the SNP locations the amount of SNP observations matches on both files. The file overall is 324,472 bytes.
```{r}
dim(snp)
object.size(snp)
```
This file however has the formating of data in a transposed version of the fang file. In addition it has the chromosome and position that the SNP are located on. The rest of the column headers are extra info that may not be needed later on.
```{r}
head(snp)
names(snp)
```


#**Data Processing**

First I'm going to sepearte out the groups that way I don't have to later worry about this column altogether.
```{r}
teosinteTarget = c('ZMMIL','ZMMLR','ZMMMR')
teosinte = filter(fang, Group %in% teosinteTarget)

maizeTarget = c('ZMPBA', 'ZMPIL', 'ZMPJA')
maize = filter(fang, Group %in% maizeTarget)
```

Now I need to transpose the files after removing the columns I don't care about.
```{r}
teosinte = teosinte %>%
  select(1, 4:986)
maize = maize %>%
  select(1, 4:986)
snp = snp %>%
  select(1,3,4)
```

Next I transposed the fang data for the maize and teosinte, wrote it to a seperate file without the headers(they will be added back later when combined with the SNP file), and read that file back into R with the headers. Now the SNP locations are going across the top of the file. I then took the SNP first column and added it onto the beginging of the fang file -> Labeledfang. Now we have two files that are ready for merging!

```{r}
Tteosinte = as.data.frame(t(teosinte))
Tmaize = as.data.frame(t(maize))
```

```{r}
write_csv(Tteosinte, "TeoNoHeaders", col_names = FALSE)
write_csv(Tmaize, "MaizeNoHeaders", col_names = FALSE)
```

```{r}
Tteosinte2 = read_csv("TeoNoHeaders", col_names = TRUE)
Tmaize2 = read_csv("MaizeNoHeaders", col_names = TRUE)
Sample_ID = snp %>%
  select(1)
LabeledTeo = cbind(Sample_ID, Tteosinte2)
LabeledMaize = cbind(Sample_ID, Tmaize2)
```

Now I'm going to merge both files by the first column that they share. But first I need to add back in the group column. The files are now formated as specified in the rubric, with the SNP_ID in the first column, Chromosome in the second column, and Position in the third column.
```{r}
MergedTeo = merge(snp, LabeledTeo, by="SNP_ID")
MergedMaize = merge(snp, LabeledMaize, by="SNP_ID")
```

Great! Now we have a file to work with for the rest of the data analysis. However I want to write this file into a .csv doc because I will be working with it a lot. That way I have it if ever needed. 
```{r}
write_csv(MergedTeo, "MergedTeo", col_names = TRUE)
write_csv(MergedMaize, "MergedMaize", col_names = TRUE)
```

##**Teosinte**
ZMMIL, ZMMLR, and ZMMMR
*The file that I'm working with at the start is MergedTeo*

First I'm going to filter out by the chromosome, arrange that such that the position is ordered in ascending order, and then write those as seperate files. I was having issuse at first due to the posion column's data type being listed as Factor and not a numeric value. By adding in the line of code that converted the data to numeric I was able to get around this.
```{r}
setwd("C:/Users/gnick/Box/EEOB 546X/GN_R_assignment/teosinte/Ascending")
#I want to store the files in this specific folder hence why I had to change to working directory
i = 1
while(i <= 10){
  a = i
  ChromTeosinteAscending = filter(MergedTeo, MergedTeo$Chromosome == a)
  ChromTeosinteAscending$Position = as.numeric(as.character(ChromTeosinteAscending$Position))
  ChromTeosinteAscending = ChromTeosinteAscending[order(ChromTeosinteAscending$Position), ]
  write_csv(ChromTeosinteAscending, sprintf("Ascending_TeoChromosome_%s", a), col_names = TRUE)
  i = i + 1
}
```

First step is to replace the ? characters with the - character.
```{r}
i = 4 
DecMergedTeo = MergedTeo
for(i in names(DecMergedTeo)){
  DecMergedTeo[[i]] = gsub("\\?","-", DecMergedTeo[[i]])
}

```
Now I need to as last time seperate out the chromosomes and order them in decreasing order.
```{r}
setwd("C:/Users/gnick/Box/EEOB 546X/GN_R_assignment/teosinte/Decreasing")
#again I changed the working directory to put the files in the correct folder

i = 1
while(i <= 10){
  a = i
  ChromTeosinteDecreasing = filter(DecMergedTeo, DecMergedTeo$Chromosome == a)
  ChromTeosinteDecreasing$Position = as.numeric(as.character(ChromTeosinteDecreasing$Position))
  ChromTeosinteDecreasing = ChromTeosinteDecreasing[order(ChromTeosinteDecreasing$Position, decreasing = TRUE), ]
  write_csv(ChromTeosinteDecreasing, sprintf("Decreasing_TeoChromosome_%s", a), col_names = TRUE)
  i = i + 1
}
```
Great! Now I have all 20 of the files I needed organized into files within the repository. Now the easy part, doing the same with the maize files. Since most of the code will be recycled I'm not going to put as many comments over every chunk I run.

##**Maize**
ZMPBA, ZMPIL, and ZMPJA
*The file that I'm working with at the start is MergedMaize*

First as last time I'm doing the ascending order.
```{r}
setwd("C:/Users/gnick/Box/EEOB 546X/GN_R_assignment/maize/Ascending")
#I want to store the files in this specific folder hence why I had to change to working directory
i = 1
while (i <= 10){
  a = i
  ChromMaizeAscending = filter(MergedMaize, MergedMaize$Chromosome == a)
  ChromMaizeAscending$Position = as.numeric(as.character(ChromMaizeAscending$Position))
  ChromMaizeAscending = ChromMaizeAscending[order(ChromMaizeAscending$Position), ]
  write_csv(ChromMaizeAscending, sprintf("Ascending_MaizeChromosome_%s", a), col_names = TRUE)
  i = i + 1
}

```

Now I will replace the ? characters with the - character.
```{r}
i = 4 
DecMergedMaize = MergedMaize
for(i in names(DecMergedMaize)){
  DecMergedMaize[[i]] = gsub("\\?","-", DecMergedMaize[[i]])
}

```
Next I'm seperating out the chromosomes and ordering them in decreasing order.
```{r}
setwd("C:/Users/gnick/Box/EEOB 546X/GN_R_assignment/maize/Decreasing")
#again I changed the working directory to put the files in the correct folder

i = 1
while(i <= 10){
  a = i
  ChromMaizeDecreasing = filter(DecMergedMaize, DecMergedMaize$Chromosome == a)
  ChromMaizeDecreasing$Position = as.numeric(as.character(ChromMaizeDecreasing$Position))
  ChromMaizeDecreasing = ChromMaizeDecreasing[order(ChromMaizeDecreasing$Position, decreasing = TRUE), ]
  write_csv(ChromMaizeDecreasing, sprintf("Decreasing_MaizeChromosome_%s", a), col_names = TRUE)
  i = i + 1
}
```

#**Part 2: Data Visualizaion**
```{r}

```


